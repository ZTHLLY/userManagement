## 流程

需求分析=>设计=>技术选型=>初始化/引入技术=>写demo=>写代码=>测试=>代码提交

## 需求

1. 登录/注册
2. 用户管理（管理员），查询，修改

## 技术选型

前端： 三件套+react+组件库 Ant Design+Umi+ant design pro

后端： 

+ java
+ spring                依赖注入框架，帮助管理Java对象，集成其他内容
+ springmvc            web框架，提供接口访问
+ mybatis          java操作数据库框架，持久层框架
+ mybatis-plus   对mybatis的增强，不用写sql了
+ springboot     不用自己管理spring配置，不用自己整合框架，快速启动/集成项目
+ mysql
+ junit 自动测试 

部署：服务器/容器（平台）

## 计划

1. 初始化项目
   1. 前端初始化  20min
      1. 初始化项目  ✔
      2. 引入组件 ✔
      3. 项目瘦身 ✔
   2. 后端初始化   20min
      1. 准备环境（MySQL）验证是否安装成功✔
      2. 引入框架✔
2. 数据库设计✔
2. 登录/注册  20min
   1. 前端
   2. 后端
      1. 规整项目目录
      2. 实现基本数据库操作（操作user表）
         1. user对象=>和数据库字段关联，自动生成
         1. 写登录逻辑
   
1. 用户管理   20min
   1. 前端
   2. 后端

## 项目初始化

```bash
npm i @ant-design/pro-cli -g
pro create myapp
```

用umi3版本，简单脚手架（simple），

### 安装依赖

直接yarn就可以安装了

yarn add @umijs/preset-ui -D    ---------->安装umiui

### 后端初始化

三种方式：

1. GitHub拉取，不建议，因为可能有屎山（
2. springboot官网拉模板 https://start.spring.io/
3. IDEA开发工具中生成  ✔（最推荐）

找不到依赖直接去meavn仓库找：https://mvnrepository.com/

## 数据库设计

里面有数据表（理解为excel表）

Java操作数据库，代替人工



表中的字段有什么？是什么类型？字段添加索引

表与表之间的关联





用户表：

id（主键） varchar

username 昵称  varchar

account 账号 varchar

avatarUrl 头像   varchar

gender 性别 int 

userPassword 密码  varchar

phone 电话  varchar

Email 邮箱  varchar

userStatus 用户状态(比如被封号)  int 0-正常

---

createTime 创建时间（数据插入时间）datetime

updateTime 更新时间（数据更新时间）datetime

isDelete 是否删除（逻辑删除）

## 自动生成器的使用

mybatisx插件，自动根据数据库生成domain实体对象、mapper（操作数据库的对象，mapper.xml（定义了mapper对象和数据库的关联，可以在里面自己写sql) ，service（包含常用的增删改查），servicempl（具体）

## 注册逻辑

1. 用户在前端输入账户和密码，以及校验码
2. 校验用户的账户，密码，校验密码是否符合要求
   1. 非空 ✔
   2. 账户不小于4位✔
   3. 密码不小于8位✔
   4. 账户不能重复✔
   5. 账户不包含特殊字符❌
   6. 密码和校验密码相同✔
3. 对密码进行加密（密码千万不要以明文直接存储到数据库中）✔
4. 向数据库插入用户数据✔

## 登录接口

接受参数：用户账户、密码

请求类型：POST

请求体：JSON格式的数据

> 请求参数很长时不用get

返回值：用户信息（脱敏）

## 登录逻辑

1. 校验用户账户和密码是否合法

   1. 非空 ✔
   2. 账户不小于4位✔

   3. 密码不小于8位✔

   4. 账户不包含特殊字符❌

2. 校验密码是否输入正确，和数据库密文对比✔

3. 用户信息脱敏，隐藏敏感信息，防止数据库字段泄露✔

4. 记录用户登录态（session），存到服务器上（用spring boot框架封装的服务器tomcat去记录）cookie✔

5. 返回脱敏后用户信息✔



## 第三期计划

1. 开发完成后端登录功能 20min（单机登录=>后续改造为分布式/第三方登录）✔
2. 开发后端用户的管理接口 20min （用户查询/状态更改）
3. 开发前端用户登录注册功能 40min-1h
4. 讨论如何校验用户（特定用户）

## 如何知道是哪个用户登录了

1. 链接服务器端后得到一个session状态（匿名会话），返回给前端
2. 登录成功后，得到了成功的session，给该session设置一些值（比如用户信息），返回给前端一个设置cookie的命令
3. 前端接收到后端的命令后，设置cookie，保存到浏览器内
4. 前端再次请求后端的时候（相同的域名），在请求头中带上cookie去请求
5. 后端拿到前端传来的cookie，找到对应的session
6. 后端从session中可以取出基于该session存储的变量（用户的登录信息，登录名）

## 控制层Controller封装请求

```
@RestController 适用于编写restful风格的api，返回默认值为json内容
```

controller层倾向于对请求本身的校验，不涉及业务逻辑本身

service 层是对业务逻辑的校验（有可能被controller之外的类调用）

## 用户管理接口

！！！必须鉴权

1. 查询用户
   1. 允许用户名查询
2. 删除用户
